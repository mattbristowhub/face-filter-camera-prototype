<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Face Filter Camera - Refactored</title>
    <link rel="stylesheet" href="./styles/base.css">
    <link rel="stylesheet" href="./styles/safari.css">
    <link rel="stylesheet" href="./styles/responsive.css">
</head>
<body>
    <div class="container">
        <div class="camera-container">
            <video id="video" autoplay playsinline></video>
            <canvas id="overlay"></canvas>
            <div class="preview-flash"></div>
            <img id="capturedImage" alt="Captured photo">
        </div>

        <div class="status">
            <span id="statusText">Initializing...</span>
        </div>

        <div class="info">
            ğŸ’¡ <strong>Animated Filters + Extreme Morph!</strong><br>
            Interactive filters for children & pets + cartoon morph with massive eyes & huge mouth. Multi-face preview only. Photos save unfiltered.
        </div>

        <div class="controls">
            <div class="filter-selector">
                <button class="filter-btn active" data-filter="none">âŒ</button>
                <button class="filter-btn" data-filter="bouncing_balls">âš½</button>
                <button class="filter-btn" data-filter="twinkling_stars">â­</button>
                <button class="filter-btn" data-filter="floating_hearts">ğŸ’•</button>
                <button class="filter-btn" data-filter="pet_dots">ğŸ”´</button>
                <button class="filter-btn" data-filter="prey_fish">ğŸŸ</button>
                <button class="filter-btn" data-filter="sparkle_burst">âœ¨</button>
                <button class="filter-btn" data-filter="face_morph">ğŸ­</button>
            </div>
            <button class="capture-btn" id="captureBtn"></button>
        </div>

        <div class="loading" id="loading">Loading face detection model...</div>
    </div>

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@0.0.3/dist/face-landmarks-detection.min.js"></script>

    <!-- Main Application (ES6 Modules) -->
    <script type="module">
        import { FaceFilterApp } from './src/main.js';

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Create app instance
                const app = new FaceFilterApp(window.tf, window.faceLandmarksDetection);

                // Initialize
                await app.init();

                // Make app available globally for debugging
                window.faceFilterApp = app;

                // Log stats periodically
                setInterval(() => {
                    const stats = app.getStats();
                    console.log('App Stats:', stats);
                }, 30000); // Every 30 seconds

            } catch (error) {
                console.error('Failed to initialize app:', error);
                document.getElementById('statusText').textContent = `Error: ${error.message}`;
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.faceFilterApp) {
                window.faceFilterApp.destroy();
            }
        });
    </script>
</body>
</html>
